<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/jpg" href="/stats/SD20000.gif"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperDetector20000 - CWE Detection System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box }
        body { font-family:Arial,sans-serif; background:#f5f5f5; color:#333; line-height:1.6 }
        .container { max-width:1000px; margin:0 auto; padding:20px }
        header { text-align:center; margin-bottom:40px; padding-bottom:20px; border-bottom:2px solid #ddd }
        h1 { font-size:2.2rem; margin-bottom:10px }
        .subtitle { color:#666; margin-bottom:20px }
        .status { 
            background:#e3f2fd; border-left:4px solid #2196f3; 
            padding:15px; margin:20px 0; border-radius:4px 
        }
        .download-btn {
            display:inline-block; padding:12px 24px; background:#2196f3; color:white;
            text-decoration:none; border-radius:4px; font-weight:600
        }
        .section { margin:40px 0 }
        .section h2 { 
            font-size:1.4rem; margin-bottom:20px; padding-bottom:10px; 
            border-bottom:1px solid #ddd 
        }
        .metrics {
            display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
            gap:20px; margin-bottom:30px
        }
        .metric {
            background:white; border:1px solid #ddd; border-radius:4px;
            padding:25px; text-align:center
        }
        .metric-value { font-size:2rem; font-weight:bold; margin-bottom:5px }
        .metric-label { color:#666; font-size:0.9rem }
        .chart { background:white; border:1px solid #ddd; border-radius:4px; padding:20px; height:350px }
        table { width:100%; background:white; border:1px solid #ddd; border-radius:4px; overflow:hidden }
        th { background:#f8f9fa; padding:12px; font-weight:600; border-bottom:1px solid #ddd }
        td { padding:12px; border-bottom:1px solid #f0f0f0 }
        .history-section {
            text-align:center; background:white; border:1px solid #ddd; 
            border-radius:4px; padding:30px; margin:40px 0
        }
        .history-btn {
            display:inline-block; padding:12px 25px; background:#2196f3; color:white;
            text-decoration:none; border-radius:4px; font-weight:600
        }
        footer { text-align:center; margin-top:40px; color:#666; font-size:0.9rem }
        @media (max-width:768px) { .metrics { grid-template-columns:1fr } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SuperDetector20000</h1>
            <div class="status" id="status"></div>
            <a href="build/simple/cwe_model_latest.pkl" download class="download-btn">
                Download Model
            </a>
        </header>

        <div class="section">
            <h2>Performance Metrics</h2>
            <div class="metrics" id="metrics"></div>
        </div>

        <div class="section">
            <h2>CWE Distribution</h2>
            <div class="chart">
                <canvas id="chart"></canvas>
            </div>
        </div>

        <div class="section">
            <h2>Top CWE Types</h2>
            <table id="table">
                <thead>
                    <tr><th>CWE ID</th><th>Samples</th><th>Percentage</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="history-section">
            <h3>Model History</h3>
            <p>View performance evolution and archived models</p>
            <a href="stats/old_stat.html" class="history-btn">View History</a>
        </div>
    </div>

    <script>
        let data = null;
        let isReal = false;

        async function loadData() {
            try {
                const res = await fetch('stats/model_statistics.json');
                if (!res.ok) throw new Error('Not found');
                data = await res.json();
                isReal = true;
            } catch {
                data = {
                    generated_at: new Date().toISOString(),
                    dataset: {
                        total_samples: 101231,
                        unique_cwes: 118,
                        cwe_distribution: {
                            CWE122:9652, CWE121:7889, CWE78:7813, CWE190:6458, CWE762:6106,
                            CWE134:4929, CWE191:4732, CWE590:4231, CWE36:3907, CWE23:3907
                        }
                    },
                    performance: { accuracy:87.3, precision:88.5, recall:86.1}
                };
                isReal = false;
            }
            updateUI();
        }

        function updateUI() {
            updateStatus();
            updateMetrics();
            updateTable();
            updateChart();
        }

        function updateStatus() {
            const el = document.getElementById('status');
            if (isReal) {
                const date = new Date(data.generated_at).toLocaleString();
                el.innerHTML = `<strong>Real Data</strong> - ${date}`;
            } else {
                el.innerHTML = `<strong>Demo Data</strong> - Statistics unavailable`;
            }
        }

        function updateMetrics() {
            const p = data.performance;
            const d = data.dataset;
            const metrics = [
                { value: `${p.accuracy}%`, label:'Accuracy' },
                { value: d.total_samples.toLocaleString(), label:'Samples' },
                { value: d.unique_cwes, label:'CWE Types' },
            ];
            document.getElementById('metrics').innerHTML = metrics.map(m =>
                `<div class="metric">
                    <div class="metric-value">${m.value}</div>
                    <div class="metric-label">${m.label}</div>
                </div>`
            ).join('');
        }

        function updateTable() {
            const dist = data.dataset.cwe_distribution;
            const total = data.dataset.total_samples;
            const rows = Object.entries(dist).map(([cwe, count]) => ({
                cwe, count, pct: ((count/total)*100).toFixed(1)
            }));
            document.querySelector('#table tbody').innerHTML = rows.map(r =>
                `<tr><td>${r.cwe}</td><td>${r.count.toLocaleString()}</td><td>${r.pct}%</td></tr>`
            ).join('');
        }

        function updateChart() {
            const dist = data.dataset.cwe_distribution;
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#C9CBCF', '#4BC0C0', '#FF6384', '#36A2EB'
            ];
            
            new Chart(document.getElementById('chart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(dist),
                    datasets: [{
                        data: Object.values(dist),
                        backgroundColor: colors,
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
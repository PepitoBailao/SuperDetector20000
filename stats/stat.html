<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperDetector20000 - Performance Analysis</title>
    <link rel="icon" href="https://cdn-icons-mp4.flaticon.com/512/6172/6172533.mp4" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:Arial,sans-serif;background-color:#f8f9fa;color:#2c3e50;line-height:1.6}
        .container{max-width:1200px;margin:0 auto;padding:40px 20px}
        header{text-align:center;margin-bottom:50px;padding-bottom:20px;border-bottom:2px solid #e9ecef}
        h1{font-size:2.5rem;font-weight:300;color:#2c3e50;margin-bottom:10px}
        .subtitle{font-size:1.1rem;color:#6c757d;font-weight:400}
        .metrics-section{margin-bottom:50px}
        .section-title{font-size:1.5rem;font-weight:600;color:#2c3e50;margin-bottom:30px;padding-bottom:10px;border-bottom:1px solid #e9ecef}
        .metrics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:30px;margin-bottom:40px}
        .metric-card{background:white;border:1px solid #e9ecef;border-radius:4px;padding:30px 25px;text-align:center}
        .metric-value{font-size:2.8rem;font-weight:700;color:#2c3e50;margin-bottom:8px}
        .metric-label{font-size:0.95rem;color:#6c757d;text-transform:uppercase;letter-spacing:0.5px}
        .charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:30px;margin-bottom:40px}
        .chart-container{background:white;border:1px solid #e9ecef;border-radius:4px;padding:30px;height:400px}
        .chart-title{font-size:1.2rem;font-weight:600;color:#2c3e50;margin-bottom:20px;text-align:center}
        .performance-table{background:white;border:1px solid #e9ecef;border-radius:4px;margin-bottom:40px;overflow:hidden}
        table{width:100%;border-collapse:collapse}
        th{background-color:#f8f9fa;padding:15px 20px;text-align:left;font-weight:600;color:#495057;border-bottom:1px solid #e9ecef;font-size:0.9rem;text-transform:uppercase;letter-spacing:0.5px}
        td{padding:15px 20px;border-bottom:1px solid #f8f9fa;font-size:0.95rem}
        tr:last-child td{border-bottom:none}
        .specifications{background:white;border:1px solid #e9ecef;border-radius:4px;padding:30px}
        .spec-grid{display:grid;grid-template-columns:1fr 2fr;gap:15px 40px;align-items:center}
        .spec-label{font-weight:600;color:#495057;font-size:0.9rem}
        .spec-value{color:#2c3e50;font-family:'Courier New',monospace;font-size:0.9rem}
        footer{text-align:center;margin-top:60px;padding-top:30px;border-top:1px solid #e9ecef;color:#6c757d;font-size:0.9rem}
        .data-source{background:#e3f2fd;border-left:4px solid #2196f3;padding:15px;margin:20px 0;border-radius:4px}
        @media (max-width:768px){.spec-grid{grid-template-columns:1fr;gap:10px}.metrics-grid,.charts-grid{grid-template-columns:1fr;gap:20px}.chart-container{min-width:300px}h1{font-size:2rem}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SuperDetector20000</h1>
            <p class="subtitle">CWE Detection System - Performance Analysis Report</p>
            <div class="data-source" id="data-source-info"></div>
        </header>
        <div class="metrics-section">
            <h2 class="section-title">Key Performance Indicators</h2>
            <div class="metrics-grid" id="kpi-grid"></div>
        </div>
        <div class="metrics-section">
            <h2 class="section-title">Performance Visualization</h2>
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">CWE Distribution by Samples</div>
                    <canvas id="cweDistributionChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Model Performance Overview</div>
                    <canvas id="overviewChart"></canvas>
                </div>
            </div>
        </div>
        <div class="metrics-section">
            <h2 class="section-title">Top CWE Types</h2>
            <div class="performance-table">
                <table id="cwe-table">
                    <thead>
                        <tr><th>CWE ID</th><th>Samples</th><th>Percentage</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <div class="metrics-section">
            <h2 class="section-title">Model Specifications</h2>
            <div class="specifications">
                <div class="spec-grid" id="model-specs"></div>
            </div>
        </div>
        <footer>
            <p>SuperDetector20000 - Automated Vulnerability Detection System</p>
            <p>Trained on NIST Juliet Test Suite for C/C++ vulnerability detection</p>
        </footer>
    </div>
    <script>
        let statsData = null;
        let isRealData = false;
        
        async function loadStatistics() {
            try {
                const response = await fetch('model_statistics.json');
                if (!response.ok) throw new Error('Statistics file not found');
                statsData = await response.json();
                isRealData = true;
                console.log('Loaded real statistics from model_statistics.json');
                updateDataSourceInfo();
                populateKPIs();
                populateTable();
                populateSpecs();
                createCharts();
            } catch (error) {
                console.warn('Could not load real statistics, using defaults:', error);
                loadDefaultStats();
            }
        }
        
        function updateDataSourceInfo() {
            const info = document.getElementById('data-source-info');
            if (isRealData) {
                const date = new Date(statsData.generated_at).toLocaleString('fr-FR');
                info.innerHTML = `<strong>Données en temps réel</strong> - Générées le ${date}`;
                info.style.backgroundColor = '#e8f5e8';
                info.style.borderColor = '#4caf50';
            } else {
                info.innerHTML = `<strong>Données d'exemple</strong> - Les vraies statistiques ne sont pas disponibles`;
                info.style.backgroundColor = '#fff3cd';
                info.style.borderColor = '#ffc107';
            }
        }
        
        function loadDefaultStats() {
            statsData = {
                "generated_at": new Date().toISOString(),
                "dataset": {
                    "total_samples": 101231,
                    "unique_cwes": 118,
                    "cwe_distribution": {
                        "CWE122": 9652,"CWE121": 7889,"CWE78": 7813,"CWE190": 6458,"CWE762": 6106,
                        "CWE134": 4929,"CWE191": 4732,"CWE590": 4231,"CWE36": 3907,"CWE23": 3907
                    },
                    "most_common_cwe": "CWE122",
                    "avg_code_length": 1778
                },
                "model": {
                    "algorithm": "TF-IDF + Multinomial Naive Bayes",
                    "max_features": 5000,
                    "n_gram_range": "(1, 2)",
                    "train_test_split": "80% / 20%",
                    "model_size_mb": 0.9
                },
                "performance": {
                    "accuracy": 87.3,
                    "f1_score": 0.85,
                    "precision": 88.5,
                    "recall": 86.1,
                    "false_positive_rate": 8.7
                }
            };
            isRealData = false;
            updateDataSourceInfo();
            populateKPIs();
            populateTable();
            populateSpecs();
            createCharts();
        }
        
        function populateKPIs() {
            const perf = statsData.performance;
            const kpis = [
                { value: `${perf.accuracy}%`, label: 'Overall Accuracy' },
                { value: statsData.dataset.total_samples.toLocaleString(), label: 'Training Samples' },
                { value: statsData.dataset.unique_cwes, label: 'CWE Types Detected' },
                { value: perf.f1_score, label: 'F1-Score' },
                { value: `${perf.false_positive_rate}%`, label: 'False Positive Rate' },
                { value: `${statsData.model.model_size_mb} MB`, label: 'Model Size' }
            ];
            document.getElementById('kpi-grid').innerHTML = kpis.map(kpi => 
                `<div class="metric-card"><div class="metric-value">${kpi.value}</div><div class="metric-label">${kpi.label}</div></div>`
            ).join('');
        }
        
        function populateTable() {
            const total = statsData.dataset.total_samples;
            const rows = Object.entries(statsData.dataset.cwe_distribution)
                .map(([cwe, count]) => ({cwe,count,percentage: ((count / total) * 100).toFixed(1)}));
            document.querySelector('#cwe-table tbody').innerHTML = rows.map(row => 
                `<tr><td>${row.cwe}</td><td>${row.count.toLocaleString()}</td><td>${row.percentage}%</td></tr>`
            ).join('');
        }
        
        function populateSpecs() {
            const specs = [
                { label: 'Algorithm', value: statsData.model.algorithm },
                { label: 'Maximum Features', value: statsData.model.max_features?.toLocaleString() || 'N/A' },
                { label: 'N-gram Range', value: statsData.model.n_gram_range || 'N/A' },
                { label: 'Train/Test Split', value: statsData.model.train_test_split || 'N/A' },
                { label: 'Model Size', value: `${statsData.model.model_size_mb} MB` },
                { label: 'Dataset Source', value: 'NIST Juliet Test Suite v1.3' },
                { label: 'Total Samples', value: statsData.dataset.total_samples.toLocaleString() },
                { label: 'Most Common CWE', value: statsData.dataset.most_common_cwe || 'N/A' },
                { label: 'Avg Code Length', value: `${statsData.dataset.avg_code_length || 'N/A'} chars` }
            ];
            document.getElementById('model-specs').innerHTML = specs.map(spec => 
                `<div class="spec-label">${spec.label}</div><div class="spec-value">${spec.value}</div>`
            ).join('');
        }
        
        function createCharts() {
            const cweData = statsData.dataset.cwe_distribution;
            const colors = ['#28a745','#17a2b8','#ffc107','#fd7e14','#dc3545','#6f42c1','#20c997','#6610f2','#e83e8c','#fd7e14'];
            
            // CWE Distribution Chart
            new Chart(document.getElementById('cweDistributionChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cweData),
                    datasets: [{data: Object.values(cweData),backgroundColor: colors,borderWidth: 2,borderColor: '#fff'}]
                },
                options: {responsive: true,maintainAspectRatio: false,plugins: {legend: {position: 'bottom',labels: {padding: 15,font: { size: 12 }}}}}
            });
            
            // Performance Chart
            const perf = statsData.performance;
            new Chart(document.getElementById('overviewChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Accuracy', 'Precision', 'Recall', 'F1-Score'],
                    datasets: [{
                        label: 'Performance (%)',
                        data: [perf.accuracy, perf.precision, perf.recall, perf.f1_score * 100],
                        borderColor: '#2c3e50',backgroundColor: 'rgba(44, 62, 80, 0.1)',borderWidth: 3,fill: true,tension: 0.4,
                        pointBackgroundColor: '#2c3e50',pointBorderColor: '#fff',pointBorderWidth: 2,pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,maintainAspectRatio: false,
                    scales: {y: {beginAtZero: true,max: 100,ticks: {callback: function(value) {return value + '%'}}}},
                    plugins: {legend: {display: false}}
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', loadStatistics);
    </script>
</body>
</html>